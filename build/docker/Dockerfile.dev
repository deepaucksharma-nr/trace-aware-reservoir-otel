# Development Dockerfile for quick testing
FROM alpine:3.19

RUN addgroup -g 10001 otel && adduser -D -G otel -u 10001 otel
RUN mkdir -p /var/otelpersist/badger && chown -R otel:otel /var/otelpersist

# Create a mock OTEL collector for testing
RUN echo '#!/bin/sh' > /otelcol-nrdot && \
    echo 'echo "Mock OpenTelemetry Collector with Reservoir Sampler"' >> /otelcol-nrdot && \
    echo 'echo "This is a development mock for testing the deployment"' >> /otelcol-nrdot && \
    echo 'echo "In production, build using GitHub Actions with Go 1.23"' >> /otelcol-nrdot && \
    echo 'echo "Config file: $1"' >> /otelcol-nrdot && \
    echo 'while true; do sleep 10; echo "Still running..."; done' >> /otelcol-nrdot && \
    chmod +x /otelcol-nrdot

USER otel
ENTRYPOINT ["/otelcol-nrdot"]
CMD ["--config=/etc/otelcol-nrdot/config.yaml"]

EXPOSE 4317 4318 8888